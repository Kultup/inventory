# Система інвентаризації обладнання

Веб-застосунок для обліку, відстеження та управління технічними пристроями в організації з можливістю збереження історії змін, генерації QR-кодів та створення резервних копій.

![Версія](https://img.shields.io/badge/версія-1.0-blue)
![Python](https://img.shields.io/badge/Python-3.8+-green)
![Flask](https://img.shields.io/badge/Flask-3.0.2-orange)

## Зміст

- [Про проект](#про-проект)
- [Функціональні можливості](#функціональні-можливості)
- [Вимоги](#вимоги)
- [Встановлення та запуск](#встановлення-та-запуск)
- [Структура проекту](#структура-проекту)
- [Модель даних](#модель-даних)
- [API та маршрути](#api-та-маршрути)
- [Кастомізація](#кастомізація)
- [Міграція бази даних](#міграція-бази-даних)
- [Резервне копіювання](#резервне-копіювання)
- [Розгортання на виробничому сервері](#розгортання-на-виробничому-сервері)
- [Усунення несправностей](#усунення-несправностей)
- [Ліцензія](#ліцензія)
- [Зміна доменної адреси](#зміна-доменної-адреси)

## Про проект

Система інвентаризації обладнання – це веб-застосунок, розроблений для ефективного управління технічними пристроями в організації. Система дозволяє вести облік пристроїв, їх місцезнаходження, стану та історії обслуговування з підтримкою різних рівнів доступу для користувачів.

## Функціональні можливості

### Основні можливості

- **Управління пристроями**:
  - Додавання, редагування та видалення пристроїв
  - Автоматична генерація унікальних інвентарних номерів
  - Завантаження фото пристроїв
  - Відстеження стану та місцезнаходження
  - Відстеження обслуговування пристроїв

- **Управління користувачами**:
  - Різні рівні доступу (адміністратор, звичайний користувач)
  - Прив'язка користувачів до міст
  - Аутентифікація та авторизація

- **Організація за містами**:
  - Розподіл пристроїв за містами
  - Фільтрація списків за місцем розташування

- **Історія змін**:
  - Відстеження всіх змін пристроїв
  - Журнал дій користувачів

- **Експорт та імпорт даних**:
  - Експорт у Excel
  - Імпорт з Excel
  - Масовий друк інвентарних карток

- **QR-коди**:
  - Генерація QR-кодів для пристроїв
  - Друк QR-кодів для фізичного маркування

- **Резервне копіювання та відновлення**:
  - Автоматичне та ручне резервне копіювання
  - Відновлення з резервних копій

- **Адаптивний інтерфейс**:
  - Підтримка мобільних пристроїв
  - Підтримка світлої/темної теми

## Вимоги

### Для розробки та тестування

- Python 3.8 або вище
- Pip (менеджер пакетів Python)
- Доступ до інтернету для завантаження залежностей

### Залежності

Основні залежності проекту:

- Flask 3.0.2
- Flask-SQLAlchemy 3.1.1
- Flask-Login 0.6.3
- Flask-WTF 1.2.1
- Werkzeug 3.0.1
- openpyxl 3.1.2
- APScheduler 3.10.4
- qrcode 7.4.2

Повний список залежностей можна знайти у файлі `requirements.txt`.

## Встановлення та запуск

### Локальне встановлення

1. Клонуйте репозиторій:
   ```bash
   git clone <url-репозиторію>
   cd inventory-system
   ```

2. Створіть віртуальне середовище (рекомендовано):
   ```bash
   python -m venv venv
   source venv/bin/activate  # На Windows: venv\Scripts\activate
   ```

3. Встановіть залежності:
   ```bash
   pip install -r requirements.txt
   ```

4. Запустіть застосунок:
   ```bash
   python app.py
   ```

5. Відкрийте веб-браузер та перейдіть за адресою:
   ```
   http://localhost:5000
   ```

### Перший вхід

При першому запуску автоматично створюється адміністратор з такими обліковими даними:
- Логін: `admin`
- Пароль: `admin123`

**Важливо**: Змініть пароль адміністратора після першого входу!

## Структура проекту

```
inventory-system/
│
├── app.py                  # Основний файл застосунку
├── requirements.txt        # Залежності
├── README.md               # Документація
├── migrate_db.py           # Скрипт міграції бази даних
├── fix_device_history.py   # Скрипт виправлення історії пристроїв
│
├── instance/               # Дані SQLite
│   └── inventory.db        # База даних
│
├── static/                 # Статичні файли
│   ├── css/                # Стилі
│   ├── js/                 # JavaScript
│   ├── icons/              # Іконки
│   └── manifest.json       # Маніфест PWA
│
├── templates/              # HTML шаблони
│   ├── admin/              # Шаблони адміністратора
│   └── ...                 # Інші шаблони
│
├── uploads/                # Завантажені фото пристроїв
└── backups/                # Резервні копії
```

## Модель даних

### Основні моделі

- **City** - міста, де розташовані пристрої
  - `id`: Первинний ключ
  - `name`: Назва міста

- **User** - користувачі системи
  - `id`: Первинний ключ
  - `username`: Ім'я користувача
  - `password`: Хешований пароль
  - `is_admin`: Чи є користувач адміністратором
  - `is_active`: Чи активний обліковий запис
  - `city_id`: Зовнішній ключ до City

- **Device** - пристрої
  - `id`: Первинний ключ
  - `name`: Назва пристрою
  - `type`: Тип пристрою
  - `serial_number`: Серійний номер
  - `inventory_number`: Інвентарний номер
  - `location`: Місцезнаходження
  - `status`: Статус (в експлуатації, на ремонті, тощо)
  - `notes`: Примітки
  - `created_at`: Дата додавання
  - `city_id`: Зовнішній ключ до City
  - `last_maintenance`: Дата останнього обслуговування
  - `maintenance_interval`: Інтервал обслуговування в днях
  - `next_maintenance`: Дата наступного обслуговування

- **DevicePhoto** - фотографії пристроїв
  - `id`: Первинний ключ
  - `filename`: Ім'я файлу в системі
  - `original_filename`: Оригінальне ім'я файлу
  - `device_id`: Зовнішній ключ до Device
  - `uploaded_at`: Дата завантаження

- **DeviceHistory** - історія змін пристроїв
  - `id`: Первинний ключ
  - `device_id`: Зовнішній ключ до Device
  - `user_id`: Зовнішній ключ до User
  - `action`: Тип дії (створення, оновлення, видалення)
  - `field`: Яке поле було змінено
  - `old_value`: Старе значення
  - `new_value`: Нове значення
  - `timestamp`: Дата та час дії

- **UserActivity** - активність користувачів
  - `id`: Первинний ключ
  - `user_id`: Зовнішній ключ до User
  - `action`: Опис дії
  - `ip_address`: IP-адреса користувача
  - `url`: URL, на якому виконувалась дія
  - `timestamp`: Дата та час дії

- **BackupSettings** - налаштування резервного копіювання
  - `id`: Первинний ключ
  - `enable_auto_backup`: Чи увімкнено автоматичне резервне копіювання
  - `backup_interval`: Інтервал резервного копіювання
  - `retention_period`: Період зберігання копій у днях

- **Backup** - резервні копії
  - `id`: Первинний ключ
  - `filename`: Ім'я файлу резервної копії
  - `file_path`: Шлях до файлу
  - `size_bytes`: Розмір у байтах
  - `created_at`: Дата створення
  - `is_auto`: Чи створено автоматично

## API та маршрути

### Основні маршрути

- **/** - Головна сторінка
- **/wiki** - Документація по використанню системи
- **/login** - Сторінка входу
- **/logout** - Вихід з системи
- **/devices** - Список пристроїв
- **/device/add** - Додавання пристрою
- **/device/<id>** - Перегляд деталей пристрою
- **/device/<id>/edit** - Редагування пристрою
- **/device/<id>/delete** - Видалення пристрою
- **/device/<id>/history** - Історія змін пристрою
- **/device/<id>/qrcode** - Генерація QR-коду
- **/devices/export-excel** - Експорт в Excel

### Адміністративні маршрути

- **/admin/users** - Управління користувачами
- **/admin/cities** - Управління містами
- **/admin/user-activity** - Журнал дій користувачів
- **/admin/backup** - Управління резервними копіями
- **/admin/dashboard** - Дашборд з аналітикою

## Кастомізація

### Зміна налаштувань

Основні налаштування знаходяться у файлі `app.py`:

```python
app.config['SECRET_KEY'] = 'ваш_секретний_ключ'  # Змініть на безпечний ключ
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///inventory.db'
app.config['UPLOAD_FOLDER'] = 'uploads'
app.config['MAX_CONTENT_LENGTH'] = 16 * 1024 * 1024  # Обмеження розміру файлу
app.config['ALLOWED_EXTENSIONS'] = {'png', 'jpg', 'jpeg', 'gif'}
app.config['BACKUP_FOLDER'] = 'backups'
```

### Додавання нових типів пристроїв

Редагуйте розкривні списки у шаблонах:
- `templates/add_device.html`
- `templates/edit_device.html`

## Міграція бази даних

### Виправлення проблем цілісності даних

Система включає скрипти для усунення помилок з таблицею `device_history`:

1. Виконайте скрипт міграції:
   ```bash
   python migrate_db.py
   ```

2. За потреби запустіть скрипт виправлення:
   ```bash
   python fix_device_history.py
   ```

Детальні інструкції з міграції є у файлі `migration_readme.md`.

## Резервне копіювання

### Автоматичне резервне копіювання

Система підтримує автоматичне резервне копіювання з налаштованим інтервалом. Налаштування доступні в інтерфейсі адміністратора.

### Ручне резервне копіювання

1. Перейдіть до розділу адміністратора: `/admin/backup`
2. Натисніть кнопку "Створити резервну копію"

### Відновлення з резервної копії

1. Перейдіть до розділу адміністратора: `/admin/backup`
2. Виберіть потрібну резервну копію та натисніть "Відновити"

## Розгортання на виробничому сервері

### Базове розгортання (без WSGI)

1. Скопіюйте всі файли проекту на сервер
2. Встановіть залежності:
   ```bash
   pip install -r requirements.txt
   ```
3. Запустіть застосунок:
   ```bash
   python app.py
   ```

### Розгортання з Gunicorn і Nginx (рекомендовано)

1. Встановіть Gunicorn:
   ```bash
   pip install gunicorn
   ```

2. Створіть файл `wsgi.py`:
   ```python
   from app import app
   
   if __name__ == '__main__':
       app.run()
   ```

3. Запустіть з Gunicorn:
   ```bash
   gunicorn --bind 0.0.0.0:8000 wsgi:app
   ```

4. Налаштуйте Nginx як проксі-сервер.

### Створення служби systemd

Створіть файл `/etc/systemd/system/inventory.service`:

```ini
[Unit]
Description=Inventory System
After=network.target

[Service]
User=username
WorkingDirectory=/path/to/inventory-system
ExecStart=/path/to/venv/bin/gunicorn --workers 3 --bind 0.0.0.0:8000 wsgi:app
Restart=always

[Install]
WantedBy=multi-user.target
```

Запустіть службу:
```bash
sudo systemctl enable inventory
sudo systemctl start inventory
```

## Усунення несправностей

### Поширені проблеми

#### Помилка при видаленні пристроїв
Якщо виникає помилка:
```
IntegrityError: NOT NULL constraint failed: device_history.device_id
```
Виконайте міграцію бази даних за інструкціями вище.

#### Проблеми з завантаженням файлів
Переконайтеся, що папка `uploads` існує і має правильні права доступу:
```bash
mkdir -p uploads
chmod 755 uploads
```

#### Помилки при запуску
- Перевірте, чи всі залежності встановлено
- Перевірте версію Python (має бути 3.8+)
- Перевірте шляхи до файлів

## Зміна доменної адреси

Для зміни доменної адреси потрібно відредагувати файл `app.py`. Знайдіть наступний блок коду в кінці файлу:

```python
if __name__ == '__main__':
    with app.app_context():
        db.create_all()
        create_admin()
        init_scheduler()  # Ініціалізуємо планувальник задач
    # app.run(host='krainamriy.fun', port=80, debug=True)  # Для продакшену
    app.run(debug=True)  # Для розробки
```

Для розробки використовуйте:
```python
app.run(debug=True)  # Для розробки
```

Для продакшену розкоментуйте та змініть рядок:
```python
app.run(host='krainamriy.fun', port=80, debug=True)  # Для продакшену
```

Замініть `krainamriy.fun` на вашу доменну адресу та встановіть потрібний порт (зазвичай 80 для HTTP або 443 для HTTPS).
