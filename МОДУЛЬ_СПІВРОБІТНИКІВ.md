# Модуль співробітників

## Реалізовано

### 1. Модель співробітника (Employee)

**Поля:**
- `id` - унікальний ідентифікатор
- `first_name` - ім'я
- `last_name` - прізвище
- `middle_name` - по батькові
- `position` - посада
- `department` - відділ
- `phone` - телефон
- `email` - email
- `city_id` - зв'язок з містом
- `is_active` - статус активності
- `notes` - примітки
- `created_at`, `updated_at` - дати створення та оновлення

**Властивості (Properties):**
- `full_name` - повне ім'я (Прізвище Ім'я По Батькові)
- `short_name` - коротке ім'я (Прізвище І. П.)

### 2. Прив'язка пристроїв до співробітників

Додано нове поле в модель `Device`:
- `assigned_to_employee_id` - ідентифікатор призначеного співробітника
- Foreign key до таблиці `employee`
- Index для швидкого пошуку

**Зв'язки:**
- Device → Employee (many-to-one)
- Employee → Devices (one-to-many)

### 3. Міграція бази даних

**Створена міграція:** `768d194fbe56`
- Додано таблицю `employee`
- Додано поле `assigned_to_employee_id` до таблиці `device`
- Створено foreign key `fk_device_assigned_to_employee`
- Створено index `ix_device_assigned_to_employee_id`

### 4. Blueprint для управління співробітниками

Файл: `blueprints/employees.py`

**Маршрути:**

1. **`/employees`** - список співробітників
   - Показує всіх співробітників з фільтрацією по містах
   - Для адміністраторів - всі міста
   - Для звичайних користувачів - тільки своє місто

2. **`/employees/<id>`** - детальна інформація
   - Повна інформація про співробітника
   - Список призначених пристроїв
   - Можливість редагування та деактивації

3. **`/employees/add`** - додавання нового
   - Форма з усіма полями
   - Валідація даних
   - Прив'язка до міста

4. **`/employees/<id>/edit`** - редагування
   - Оновлення всіх полів
   - Збереження історії змін

5. **`/employees/<id>/delete`** - видалення
   - Перевірка наявності пристроїв
   - Захист від видалення якщо є пристрої

6. **`/employees/<id>/toggle-active`** - активна/неактивна
   - Швидке перемикання статусу
   - Логування активності

### 5. Шаблони (Templates)

**Створені файли:**

1. **`templates/employees.html`** - список співробітників
   - Таблиця з усіма даними
   - Статус (активний/неактивний)
   - Кількість пристроїв
   - Дії (переглянути, редагувати)

2. **`templates/add_employee.html`** - форма додавання
   - Особиста інформація (ПІБ)
   - Робоча інформація (посада, відділ)
   - Контакти (телефон, email)
   - Місто
   - Примітки

3. **`templates/edit_employee.html`** - форма редагування
   - Те ж що і add, але з заповненими даними

4. **`templates/employee_detail.html`** - детальна картка
   - Особиста інформація
   - Робоча інформація
   - Контакти
   - Примітки
   - Список призначених пристроїв

### 6. Навігація

Додано пункт меню **"Співробітники"** в основну навігацію:
- Між "Пристрої" та адмін-розділом
- Доступний для всіх авторизованих користувачів

## Безпека та доступ

1. **Перевірка доступу до міста**
   - Звичайні користувачі бачать тільки співробітників свого міста
   - Адміністратори бачать всіх

2. **Захист від видалення**
   - Не можна видалити співробітника з пристроями
   - Спочатку потрібно зняти призначення з пристроїв

3. **Логування дій**
   - Всі дії записуються в UserActivity
   - Враховується IP та user agent

## Приклад використання

### Додавання співробітника

1. Відкрити "Співробітники" в меню
2. Натиснути "Додати співробітника"
3. Заповнити форму:
   - Прізвище, Ім'я, По батькові
   - Посада, Відділ
   - Телефон, Email
   - Місто (для адміністраторів)
   - Примітки
4. Натиснути "Додати"

### Призначення пристрою співробітнику

TODO: Додати в форму редагування пристрою dropdown зі співробітниками

### Перегляд пристроїв співробітника

1. Відкрити картку співробітника
2. Прокрутити до розділу "Пристрої"
3. Переглянути всі призначені пристрої

## Майбутні покращення

1. **Масова призначення пристроїв**
   - Вибір декількох пристроїв
   - Призначення одному співробітнику

2. **Історія призначень**
   - Запис історії змін призначення
   - Дата призначення/зняття

3. **Фото співробітника**
   - Avatar в картці
   - Відображення в списку

4. **Експорт співробітників**
   - Excel
   - PDF

5. **Статистика**
   - Кількість пристроїв на співробітника
   - Розподіл за відділами

## Зміни в БД

```sql
-- Нова таблиця
CREATE TABLE employee (
    id INTEGER PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    middle_name VARCHAR(50),
    position VARCHAR(100),
    department VARCHAR(100),
    phone VARCHAR(20),
    email VARCHAR(100),
    city_id INTEGER NOT NULL,
    is_active BOOLEAN DEFAULT 1,
    notes TEXT,
    created_at DATETIME,
    updated_at DATETIME,
    FOREIGN KEY (city_id) REFERENCES city (id)
);

-- Оновлення таблиці device
ALTER TABLE device ADD COLUMN assigned_to_employee_id INTEGER;
CREATE INDEX ix_device_assigned_to_employee_id ON device(assigned_to_employee_id);
CREATE FOREIGN KEY fk_device_assigned_to_employee REFERENCES employee(id);
```

## Реєстрація в app.py

```python
from blueprints.employees import employees_bp
app.register_blueprint(employees_bp)
```

## Тестування

1. Додайте співробітника
2. Перегляньте список
3. Відредагуйте дані
4. Перегляньте деталі
5. Деактивуйте/активуйте
6. Спробуйте видалити з пристроями (має захист)

